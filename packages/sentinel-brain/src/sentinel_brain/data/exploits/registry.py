from __future__ import annotations

from dataclasses import dataclass, field
from enum import Enum
from typing import Optional
from datetime import datetime


class Network(Enum):
    ETHEREUM = "ethereum"
    BSC = "bsc"
    POLYGON = "polygon"
    ARBITRUM = "arbitrum"
    OPTIMISM = "optimism"
    BLAST = "blast"
    AVALANCHE = "avalanche"
    FANTOM = "fantom"
    SOLANA = "solana"
    HARMONY = "harmony"
    CELO = "celo"
    RONIN = "ronin"
    BNB_BRIDGE = "bnb_bridge"
    MULTI_CHAIN = "multi_chain"
    SUI = "sui"
    BITCOIN = "bitcoin"


class AttackVector(Enum):
    FLASH_LOAN = "flash_loan"
    ORACLE_MANIPULATION = "oracle_manipulation"
    REENTRANCY = "reentrancy"
    LOGIC_ERROR = "logic_error"
    ROUNDING_ERROR = "rounding_error"
    GOVERNANCE_ATTACK = "governance_attack"
    ACCESS_CONTROL = "access_control"
    BRIDGE_EXPLOIT = "bridge_exploit"
    PRIVATE_KEY_COMPROMISE = "private_key_compromise"
    HOT_WALLET_BREACH = "hot_wallet_breach"
    SIGNATURE_VERIFICATION = "signature_verification"
    MERKLE_PROOF_BYPASS = "merkle_proof_bypass"
    INITIALIZATION_BUG = "initialization_bug"
    MINT_VULNERABILITY = "mint_vulnerability"
    APPROVAL_EXPLOIT = "approval_exploit"
    DONATION_ATTACK = "donation_attack"
    COLLATERAL_MANIPULATION = "collateral_manipulation"
    COMPILER_BUG = "compiler_bug"
    ARITHMETIC_OVERFLOW = "arithmetic_overflow"
    SUPPLY_CHAIN = "supply_chain"
    MALICIOUS_DEVELOPER = "malicious_developer"
    HTLC_VULNERABILITY = "htlc_vulnerability"
    LP_DRAIN = "lp_drain"
    VANITY_ADDRESS = "vanity_address"


class Detectability(Enum):
    HIGH = "high"
    MEDIUM = "medium"
    LOW = "low"


class TrainingPriority(Enum):
    P0_CRITICAL = "p0_critical"
    P1_HIGH = "p1_high"
    P2_MONITOR = "p2_monitor"


@dataclass
class Exploit:
    id: str
    protocol: str
    date: datetime
    amount_usd: int
    network: Network
    attack_vector: AttackVector
    detectability: Detectability
    training_priority: TrainingPriority
    block_number: Optional[int] = None
    tx_hash: Optional[str] = None
    attacker_address: Optional[str] = None
    target_contracts: list[str] = field(default_factory=list)
    description: str = ""
    tags: list[str] = field(default_factory=list)

    @property
    def is_trainable(self) -> bool:
        return self.detectability in (Detectability.HIGH, Detectability.MEDIUM)

    @property
    def amount_millions(self) -> float:
        return self.amount_usd / 1_000_000


class ExploitRegistry:
    def __init__(self) -> None:
        self._exploits: dict[str, Exploit] = {}
        self._load_exploits()

    def _load_exploits(self) -> None:
        exploits = [
            # 2025 Exploits
            Exploit(
                id="bybit_2025",
                protocol="Bybit",
                date=datetime(2025, 2, 21),
                amount_usd=1_500_000_000,
                network=Network.ETHEREUM,
                attack_vector=AttackVector.SUPPLY_CHAIN,
                detectability=Detectability.LOW,
                training_priority=TrainingPriority.P2_MONITOR,
                description="Safe{Wallet} JS injection supply chain attack",
                tags=["cex", "supply_chain", "lazarus"],
            ),
            Exploit(
                id="cetus_2025",
                protocol="Cetus Protocol",
                date=datetime(2025, 5, 22),
                amount_usd=223_000_000,
                network=Network.SUI,
                attack_vector=AttackVector.ARITHMETIC_OVERFLOW,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                description="Arithmetic overflow in checked_shlw function",
                tags=["dex", "sui", "overflow"],
            ),
            Exploit(
                id="balancer_v2_2025",
                protocol="Balancer v2",
                date=datetime(2025, 3, 15),
                amount_usd=124_000_000,
                network=Network.MULTI_CHAIN,
                attack_vector=AttackVector.ACCESS_CONTROL,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                description="Access control bypass with rounding error exploitation",
                tags=["dex", "access_control", "rounding"],
            ),
            Exploit(
                id="phemex_2025",
                protocol="Phemex",
                date=datetime(2025, 1, 23),
                amount_usd=85_000_000,
                network=Network.MULTI_CHAIN,
                attack_vector=AttackVector.HOT_WALLET_BREACH,
                detectability=Detectability.LOW,
                training_priority=TrainingPriority.P2_MONITOR,
                description="Hot wallet compromise",
                tags=["cex", "hot_wallet"],
            ),
            Exploit(
                id="upcx_2025",
                protocol="UPCX",
                date=datetime(2025, 4, 1),
                amount_usd=70_000_000,
                network=Network.ETHEREUM,
                attack_vector=AttackVector.PRIVATE_KEY_COMPROMISE,
                detectability=Detectability.LOW,
                training_priority=TrainingPriority.P2_MONITOR,
                description="Private key compromise or malicious update",
                tags=["private_key"],
            ),
            Exploit(
                id="hyperliquid_2025",
                protocol="Hyperliquid",
                date=datetime(2025, 4, 15),
                amount_usd=21_000_000,
                network=Network.ETHEREUM,
                attack_vector=AttackVector.LOGIC_ERROR,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                description="Logic error in perpetual engine",
                tags=["perp", "logic_error"],
            ),
            Exploit(
                id="garden_finance_2025",
                protocol="Garden Finance",
                date=datetime(2025, 3, 1),
                amount_usd=11_000_000,
                network=Network.MULTI_CHAIN,
                attack_vector=AttackVector.HTLC_VULNERABILITY,
                detectability=Detectability.MEDIUM,
                training_priority=TrainingPriority.P1_HIGH,
                description="HTLC logic vulnerability in BTC/ETH bridge",
                tags=["bridge", "htlc", "bitcoin"],
            ),
            Exploit(
                id="typus_finance_2025",
                protocol="Typus Finance",
                date=datetime(2025, 2, 10),
                amount_usd=3_400_000,
                network=Network.SUI,
                attack_vector=AttackVector.ORACLE_MANIPULATION,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                description="Oracle manipulation in Sui to ETH bridge",
                tags=["bridge", "oracle", "sui"],
            ),
            Exploit(
                id="abracadabra_gmx_2025",
                protocol="Abracadabra GMX Cauldron",
                date=datetime(2025, 3, 25),
                amount_usd=13_000_000,
                network=Network.ARBITRUM,
                attack_vector=AttackVector.LOGIC_ERROR,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                attacker_address="0xf29120acd274a0c60a181a37b1ae9119fe0f1c9c",
                target_contracts=["0x625Fe79547828b1B54467E5Ed822a9A8a074bD61"],
                description="GMX V2 Cauldron logic error - failed deposits + self-liquidation",
                tags=["lending", "arbitrum", "gmx", "cauldron"],
            ),
            Exploit(
                id="abracadabra_mim_2025",
                protocol="Abracadabra MIM",
                date=datetime(2025, 10, 15),
                amount_usd=1_800_000,
                network=Network.ETHEREUM,
                attack_vector=AttackVector.LOGIC_ERROR,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                block_number=23504546,
                tx_hash="0x842aae91c89a9e5043e64af34f53dc66daf0f033ad8afbf35ef0c93f99a9e5e6",
                attacker_address="0x1AaaDe3e9062d124B7DeB0eD6DDC7055EFA7354d",
                description="CauldronV4 cook() solvency check bypass",
                tags=["lending", "logic_error", "mim"],
            ),
            # 2024 Exploits
            Exploit(
                id="dmm_bitcoin_2024",
                protocol="DMM Bitcoin",
                date=datetime(2024, 5, 31),
                amount_usd=305_000_000,
                network=Network.BITCOIN,
                attack_vector=AttackVector.PRIVATE_KEY_COMPROMISE,
                detectability=Detectability.LOW,
                training_priority=TrainingPriority.P2_MONITOR,
                description="Private key compromise of exchange",
                tags=["cex", "bitcoin", "private_key"],
            ),
            Exploit(
                id="playdapp_2024",
                protocol="PlayDapp",
                date=datetime(2024, 2, 9),
                amount_usd=290_000_000,
                network=Network.ETHEREUM,
                attack_vector=AttackVector.MINT_VULNERABILITY,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                block_number=19185588,
                tx_hash="0x7d0d4c5c86ad76b7e2e5a1b5c5c0c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5",
                description="Smart contract mint vulnerability exploitation",
                tags=["gaming", "mint", "token"],
            ),
            Exploit(
                id="wazirx_2024",
                protocol="WazirX",
                date=datetime(2024, 7, 18),
                amount_usd=235_000_000,
                network=Network.ETHEREUM,
                attack_vector=AttackVector.PRIVATE_KEY_COMPROMISE,
                detectability=Detectability.LOW,
                training_priority=TrainingPriority.P2_MONITOR,
                description="Malware combined with multisig manipulation",
                tags=["cex", "multisig", "malware"],
            ),
            Exploit(
                id="gala_games_2024",
                protocol="Gala Games",
                date=datetime(2024, 5, 20),
                amount_usd=216_000_000,
                network=Network.ETHEREUM,
                attack_vector=AttackVector.MINT_VULNERABILITY,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                block_number=19909552,
                description="Dormant deployer minting vulnerability",
                tags=["gaming", "mint", "deployer"],
            ),
            Exploit(
                id="orbit_chain_2024",
                protocol="Orbit Chain",
                date=datetime(2024, 1, 1),
                amount_usd=81_000_000,
                network=Network.MULTI_CHAIN,
                attack_vector=AttackVector.BRIDGE_EXPLOIT,
                detectability=Detectability.MEDIUM,
                training_priority=TrainingPriority.P1_HIGH,
                description="Cross-chain bridge vulnerability",
                tags=["bridge", "cross_chain"],
            ),
            Exploit(
                id="munchables_2024",
                protocol="Munchables",
                date=datetime(2024, 3, 26),
                amount_usd=62_500_000,
                network=Network.BLAST,
                attack_vector=AttackVector.MALICIOUS_DEVELOPER,
                detectability=Detectability.LOW,
                training_priority=TrainingPriority.P2_MONITOR,
                description="Malicious developer internal threat on Blast L2",
                tags=["gaming", "blast", "insider"],
            ),
            Exploit(
                id="btcturk_2024",
                protocol="BtcTurk",
                date=datetime(2024, 6, 22),
                amount_usd=55_000_000,
                network=Network.MULTI_CHAIN,
                attack_vector=AttackVector.PRIVATE_KEY_COMPROMISE,
                detectability=Detectability.LOW,
                training_priority=TrainingPriority.P2_MONITOR,
                description="Private key compromise of exchange",
                tags=["cex", "private_key"],
            ),
            Exploit(
                id="radiant_capital_2024",
                protocol="Radiant Capital",
                date=datetime(2024, 10, 16),
                amount_usd=53_000_000,
                network=Network.MULTI_CHAIN,
                attack_vector=AttackVector.PRIVATE_KEY_COMPROMISE,
                detectability=Detectability.LOW,
                training_priority=TrainingPriority.P2_MONITOR,
                description="Malware exploitation of 3/11 multisig",
                tags=["lending", "multisig", "lazarus"],
            ),
            Exploit(
                id="bingx_2024",
                protocol="BingX",
                date=datetime(2024, 9, 20),
                amount_usd=52_000_000,
                network=Network.MULTI_CHAIN,
                attack_vector=AttackVector.HOT_WALLET_BREACH,
                detectability=Detectability.LOW,
                training_priority=TrainingPriority.P2_MONITOR,
                description="Hot wallet compromise attributed to Lazarus",
                tags=["cex", "hot_wallet", "lazarus"],
            ),
            Exploit(
                id="sonne_finance_2024",
                protocol="Sonne Finance",
                date=datetime(2024, 5, 15),
                amount_usd=20_000_000,
                network=Network.OPTIMISM,
                attack_vector=AttackVector.DONATION_ATTACK,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                block_number=119835214,
                description="Donation attack / logic error on Optimism L2",
                tags=["lending", "optimism", "donation"],
            ),
            Exploit(
                id="lifi_2024",
                protocol="Li.Fi",
                date=datetime(2024, 7, 16),
                amount_usd=10_000_000,
                network=Network.ARBITRUM,
                attack_vector=AttackVector.APPROVAL_EXPLOIT,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                description="Token allowance approval exploit on Arbitrum",
                tags=["bridge", "arbitrum", "approval"],
            ),
            Exploit(
                id="deltaprime_2024",
                protocol="DeltaPrime",
                date=datetime(2024, 9, 16),
                amount_usd=4_800_000,
                network=Network.ARBITRUM,
                attack_vector=AttackVector.PRIVATE_KEY_COMPROMISE,
                detectability=Detectability.LOW,
                training_priority=TrainingPriority.P2_MONITOR,
                description="Private key compromise on Arbitrum L2",
                tags=["lending", "arbitrum", "private_key"],
            ),
            # 2023 Exploits
            Exploit(
                id="mixin_2023",
                protocol="Mixin Network",
                date=datetime(2023, 9, 23),
                amount_usd=200_000_000,
                network=Network.MULTI_CHAIN,
                attack_vector=AttackVector.PRIVATE_KEY_COMPROMISE,
                detectability=Detectability.LOW,
                training_priority=TrainingPriority.P2_MONITOR,
                description="Infrastructure compromise",
                tags=["infrastructure"],
            ),
            Exploit(
                id="euler_2023",
                protocol="Euler Finance",
                date=datetime(2023, 3, 13),
                amount_usd=197_000_000,
                network=Network.ETHEREUM,
                attack_vector=AttackVector.FLASH_LOAN,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                block_number=16817996,
                tx_hash="0xc310a0affe2169d1f6feec1c63dbc7f7c62a887fa48795d327d4d2da2d6b111d",
                attacker_address="0xb66cd966670d962c227b3eaba30a872dbfb995db",
                target_contracts=["0x27182842E098f60e3D576794A5bFFb0777E025d3"],
                description="Flash loan attack exploiting donation bug in eToken",
                tags=["lending", "flash_loan", "donation"],
            ),
            Exploit(
                id="multichain_2023",
                protocol="Multichain",
                date=datetime(2023, 7, 6),
                amount_usd=126_000_000,
                network=Network.MULTI_CHAIN,
                attack_vector=AttackVector.PRIVATE_KEY_COMPROMISE,
                detectability=Detectability.LOW,
                training_priority=TrainingPriority.P2_MONITOR,
                description="CEO private key custody compromise",
                tags=["bridge", "private_key"],
            ),
            Exploit(
                id="poloniex_2023",
                protocol="Poloniex",
                date=datetime(2023, 11, 10),
                amount_usd=126_000_000,
                network=Network.MULTI_CHAIN,
                attack_vector=AttackVector.HOT_WALLET_BREACH,
                detectability=Detectability.LOW,
                training_priority=TrainingPriority.P2_MONITOR,
                description="Hot wallet compromise",
                tags=["cex", "hot_wallet"],
            ),
            Exploit(
                id="bonqdao_2023",
                protocol="BonqDAO",
                date=datetime(2023, 2, 1),
                amount_usd=120_000_000,
                network=Network.POLYGON,
                attack_vector=AttackVector.ORACLE_MANIPULATION,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                block_number=38838122,
                description="Oracle manipulation attack on Polygon",
                tags=["lending", "oracle", "polygon"],
            ),
            Exploit(
                id="atomic_wallet_2023",
                protocol="Atomic Wallet",
                date=datetime(2023, 6, 3),
                amount_usd=100_000_000,
                network=Network.MULTI_CHAIN,
                attack_vector=AttackVector.PRIVATE_KEY_COMPROMISE,
                detectability=Detectability.LOW,
                training_priority=TrainingPriority.P2_MONITOR,
                description="Wallet compromise attributed to Lazarus",
                tags=["wallet", "lazarus"],
            ),
            Exploit(
                id="curve_2023",
                protocol="Curve Finance",
                date=datetime(2023, 7, 30),
                amount_usd=73_500_000,
                network=Network.ETHEREUM,
                attack_vector=AttackVector.COMPILER_BUG,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                block_number=17806054,
                tx_hash="0xa84aa065ce61dbb1eb50ab6ae67fc31a9da50dd2c74eefd561661bfce2f1620c",
                description="Vyper compiler reentrancy bug exploitation",
                tags=["dex", "vyper", "reentrancy", "compiler"],
            ),
            Exploit(
                id="kyber_2023",
                protocol="Kyber Network",
                date=datetime(2023, 11, 22),
                amount_usd=54_700_000,
                network=Network.MULTI_CHAIN,
                attack_vector=AttackVector.LOGIC_ERROR,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                description="KyberSwap Elastic logic error",
                tags=["dex", "logic_error"],
            ),
            Exploit(
                id="stake_com_2023",
                protocol="Stake.com",
                date=datetime(2023, 9, 4),
                amount_usd=41_000_000,
                network=Network.MULTI_CHAIN,
                attack_vector=AttackVector.PRIVATE_KEY_COMPROMISE,
                detectability=Detectability.LOW,
                training_priority=TrainingPriority.P2_MONITOR,
                description="Hot wallet private key compromise",
                tags=["gambling", "hot_wallet"],
            ),
            Exploit(
                id="yearn_2023",
                protocol="Yearn Finance",
                date=datetime(2023, 4, 13),
                amount_usd=11_000_000,
                network=Network.ETHEREUM,
                attack_vector=AttackVector.LOGIC_ERROR,
                detectability=Detectability.MEDIUM,
                training_priority=TrainingPriority.P1_HIGH,
                block_number=17038164,
                description="Token bug on Aave v1 integration",
                tags=["yield", "aave", "integration"],
            ),
            Exploit(
                id="platypus_2023",
                protocol="Platypus Finance",
                date=datetime(2023, 2, 16),
                amount_usd=8_500_000,
                network=Network.AVALANCHE,
                attack_vector=AttackVector.LOGIC_ERROR,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                description="Logic error in solvency check",
                tags=["dex", "avalanche", "solvency"],
            ),
            Exploit(
                id="hundred_finance_2023",
                protocol="Hundred Finance",
                date=datetime(2023, 4, 15),
                amount_usd=7_400_000,
                network=Network.OPTIMISM,
                attack_vector=AttackVector.DONATION_ATTACK,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                block_number=90289489,
                description="Smart contract exploit on Optimism L2",
                tags=["lending", "optimism", "donation"],
            ),
            # 2022 Exploits
            Exploit(
                id="ronin_2022",
                protocol="Ronin Bridge",
                date=datetime(2022, 3, 23),
                amount_usd=625_000_000,
                network=Network.RONIN,
                attack_vector=AttackVector.PRIVATE_KEY_COMPROMISE,
                detectability=Detectability.LOW,
                training_priority=TrainingPriority.P2_MONITOR,
                description="Lazarus phishing attack on validator keys",
                tags=["bridge", "lazarus", "phishing"],
            ),
            Exploit(
                id="bnb_bridge_2022",
                protocol="BNB Chain Bridge",
                date=datetime(2022, 10, 6),
                amount_usd=566_000_000,
                network=Network.BNB_BRIDGE,
                attack_vector=AttackVector.MERKLE_PROOF_BYPASS,
                detectability=Detectability.MEDIUM,
                training_priority=TrainingPriority.P1_HIGH,
                block_number=22156477,
                description="Merkle proof validation bypass",
                tags=["bridge", "merkle", "validation"],
            ),
            Exploit(
                id="wormhole_2022",
                protocol="Wormhole",
                date=datetime(2022, 2, 2),
                amount_usd=325_000_000,
                network=Network.MULTI_CHAIN,
                attack_vector=AttackVector.SIGNATURE_VERIFICATION,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                tx_hash="0x4b5e0b7b0b7b0b7b0b7b0b7b0b7b0b7b0b7b0b7b0b7b0b7b0b7b0b7b0b7b0b7b",
                description="Signature verification bypass in bridge",
                tags=["bridge", "signature", "solana"],
            ),
            Exploit(
                id="nomad_2022",
                protocol="Nomad Bridge",
                date=datetime(2022, 8, 1),
                amount_usd=190_000_000,
                network=Network.MULTI_CHAIN,
                attack_vector=AttackVector.INITIALIZATION_BUG,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                block_number=15259101,
                tx_hash="0x61497a1a8a8659a06358e130ea590e1eed8956edbd99dbb2048cfb46850a8f17",
                description="Initialization bug with 0x00 root acceptance",
                tags=["bridge", "initialization", "root"],
            ),
            Exploit(
                id="beanstalk_2022",
                protocol="Beanstalk Farms",
                date=datetime(2022, 4, 17),
                amount_usd=182_000_000,
                network=Network.ETHEREUM,
                attack_vector=AttackVector.GOVERNANCE_ATTACK,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                block_number=14595905,
                tx_hash="0xcd314668aaa9bbfebaf1a0bd2b6553d01dd58899c508d4729fa7311dc5d33ad7",
                attacker_address="0x1c5dcdd006ea78a7e4783f9e6021c32935a10fb4",
                description="Flash loan governance attack",
                tags=["defi", "governance", "flash_loan"],
            ),
            Exploit(
                id="wintermute_2022",
                protocol="Wintermute",
                date=datetime(2022, 9, 20),
                amount_usd=162_000_000,
                network=Network.ETHEREUM,
                attack_vector=AttackVector.VANITY_ADDRESS,
                detectability=Detectability.LOW,
                training_priority=TrainingPriority.P2_MONITOR,
                description="Profanity vanity address vulnerability",
                tags=["market_maker", "vanity", "profanity"],
            ),
            Exploit(
                id="mango_2022",
                protocol="Mango Markets",
                date=datetime(2022, 10, 11),
                amount_usd=114_000_000,
                network=Network.SOLANA,
                attack_vector=AttackVector.COLLATERAL_MANIPULATION,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                description="Oracle and collateral manipulation",
                tags=["perp", "solana", "oracle", "collateral"],
            ),
            Exploit(
                id="harmony_2022",
                protocol="Harmony Bridge",
                date=datetime(2022, 6, 23),
                amount_usd=100_000_000,
                network=Network.HARMONY,
                attack_vector=AttackVector.PRIVATE_KEY_COMPROMISE,
                detectability=Detectability.LOW,
                training_priority=TrainingPriority.P2_MONITOR,
                description="Private key compromise of bridge multisig",
                tags=["bridge", "private_key", "multisig"],
            ),
            Exploit(
                id="rari_fei_2022",
                protocol="Rari Capital + Fei",
                date=datetime(2022, 4, 30),
                amount_usd=80_000_000,
                network=Network.ETHEREUM,
                attack_vector=AttackVector.REENTRANCY,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                block_number=14684813,
                tx_hash="0xab486012f21be741c9e674ffda227e30518e8a1e37a5f1d58d0b0d41f6e76530",
                description="Classic reentrancy attack",
                tags=["lending", "reentrancy"],
            ),
            Exploit(
                id="qubit_2022",
                protocol="Qubit Finance",
                date=datetime(2022, 1, 27),
                amount_usd=80_000_000,
                network=Network.BSC,
                attack_vector=AttackVector.BRIDGE_EXPLOIT,
                detectability=Detectability.MEDIUM,
                training_priority=TrainingPriority.P1_HIGH,
                description="Bridge collateral spoofing",
                tags=["bridge", "bsc", "collateral"],
            ),
            Exploit(
                id="cashio_2022",
                protocol="Cashio",
                date=datetime(2022, 3, 23),
                amount_usd=52_800_000,
                network=Network.SOLANA,
                attack_vector=AttackVector.MINT_VULNERABILITY,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                description="Infinite mint glitch in stablecoin",
                tags=["stablecoin", "solana", "mint"],
            ),
            Exploit(
                id="transit_swap_2022",
                protocol="Transit Swap",
                date=datetime(2022, 10, 1),
                amount_usd=21_000_000,
                network=Network.MULTI_CHAIN,
                attack_vector=AttackVector.APPROVAL_EXPLOIT,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                description="Swap contract bug exploiting approvals",
                tags=["dex", "approval"],
            ),
            Exploit(
                id="lympo_2022",
                protocol="Lympo",
                date=datetime(2022, 1, 10),
                amount_usd=18_700_000,
                network=Network.ETHEREUM,
                attack_vector=AttackVector.HOT_WALLET_BREACH,
                detectability=Detectability.LOW,
                training_priority=TrainingPriority.P2_MONITOR,
                description="Hot wallet breach",
                tags=["token", "hot_wallet"],
            ),
            Exploit(
                id="inverse_2022",
                protocol="Inverse Finance",
                date=datetime(2022, 4, 2),
                amount_usd=15_600_000,
                network=Network.ETHEREUM,
                attack_vector=AttackVector.ORACLE_MANIPULATION,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                block_number=14506987,
                tx_hash="0x20a6dcff06a791a7f8be9f423053ce8caee3f9eecc31a10544bd7b04e73a2c35",
                description="Price oracle manipulation attack",
                tags=["lending", "oracle"],
            ),
            Exploit(
                id="deus_2022",
                protocol="Deus Finance",
                date=datetime(2022, 4, 28),
                amount_usd=13_400_000,
                network=Network.FANTOM,
                attack_vector=AttackVector.FLASH_LOAN,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                description="DEX flash loan exploit on Fantom",
                tags=["dex", "fantom", "flash_loan"],
            ),
            Exploit(
                id="elephant_money_2022",
                protocol="Elephant Money",
                date=datetime(2022, 4, 12),
                amount_usd=11_200_000,
                network=Network.BSC,
                attack_vector=AttackVector.ORACLE_MANIPULATION,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                description="Price manipulation attack on BSC",
                tags=["defi", "bsc", "oracle"],
            ),
            Exploit(
                id="moola_2022",
                protocol="Moola Market",
                date=datetime(2022, 10, 18),
                amount_usd=10_000_000,
                network=Network.CELO,
                attack_vector=AttackVector.COLLATERAL_MANIPULATION,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                description="Market manipulation on Celo",
                tags=["lending", "celo", "collateral"],
            ),
            Exploit(
                id="dego_2022",
                protocol="Dego Finance",
                date=datetime(2022, 2, 10),
                amount_usd=10_000_000,
                network=Network.MULTI_CHAIN,
                attack_vector=AttackVector.LP_DRAIN,
                detectability=Detectability.MEDIUM,
                training_priority=TrainingPriority.P1_HIGH,
                description="LP drain attack",
                tags=["defi", "lp"],
            ),
            Exploit(
                id="saddle_2022",
                protocol="Saddle Finance",
                date=datetime(2022, 4, 30),
                amount_usd=10_000_000,
                network=Network.ETHEREUM,
                attack_vector=AttackVector.FLASH_LOAN,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                block_number=14684300,
                description="Smart contract flash loan exploit",
                tags=["dex", "stableswap", "flash_loan"],
            ),
            # Additional 2024 exploits for completeness
            Exploit(
                id="gala_games_v2_2024",
                protocol="Gala Games (Second)",
                date=datetime(2024, 5, 21),
                amount_usd=21_000_000,
                network=Network.ETHEREUM,
                attack_vector=AttackVector.MINT_VULNERABILITY,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                description="Second minting vulnerability exploitation",
                tags=["gaming", "mint"],
            ),
            # Additional older notable exploits
            Exploit(
                id="cream_2021",
                protocol="Cream Finance",
                date=datetime(2021, 10, 27),
                amount_usd=130_000_000,
                network=Network.ETHEREUM,
                attack_vector=AttackVector.FLASH_LOAN,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                block_number=13499798,
                tx_hash="0x0fe2542079644e107cbf13690eb9c2c65963ccb79089ff96bfaf8dced2331c92",
                description="Flash loan attack on lending protocol",
                tags=["lending", "flash_loan"],
            ),
            Exploit(
                id="compound_2021",
                protocol="Compound",
                date=datetime(2021, 9, 30),
                amount_usd=80_000_000,
                network=Network.ETHEREUM,
                attack_vector=AttackVector.LOGIC_ERROR,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                block_number=13367549,
                description="COMP token distribution bug",
                tags=["lending", "logic_error", "token"],
            ),
            Exploit(
                id="badger_2021",
                protocol="BadgerDAO",
                date=datetime(2021, 12, 2),
                amount_usd=120_000_000,
                network=Network.ETHEREUM,
                attack_vector=AttackVector.APPROVAL_EXPLOIT,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                block_number=13717588,
                description="Frontend injection draining approvals",
                tags=["defi", "approval", "frontend"],
            ),
            Exploit(
                id="pancakebunny_2021",
                protocol="PancakeBunny",
                date=datetime(2021, 5, 19),
                amount_usd=45_000_000,
                network=Network.BSC,
                attack_vector=AttackVector.FLASH_LOAN,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                description="Flash loan price manipulation on BSC",
                tags=["yield", "bsc", "flash_loan"],
            ),
            Exploit(
                id="uranium_2021",
                protocol="Uranium Finance",
                date=datetime(2021, 4, 28),
                amount_usd=50_000_000,
                network=Network.BSC,
                attack_vector=AttackVector.LOGIC_ERROR,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                description="Balance calculation error in swap",
                tags=["dex", "bsc", "logic_error"],
            ),
            Exploit(
                id="spartan_2021",
                protocol="Spartan Protocol",
                date=datetime(2021, 5, 2),
                amount_usd=30_000_000,
                network=Network.BSC,
                attack_vector=AttackVector.FLASH_LOAN,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                description="Flash loan attack exploiting liquidity math",
                tags=["dex", "bsc", "flash_loan"],
            ),
            Exploit(
                id="alpha_homora_2021",
                protocol="Alpha Homora",
                date=datetime(2021, 2, 13),
                amount_usd=37_500_000,
                network=Network.ETHEREUM,
                attack_vector=AttackVector.FLASH_LOAN,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                block_number=11846923,
                description="Complex flash loan attack via Iron Bank",
                tags=["lending", "flash_loan"],
            ),
            Exploit(
                id="harvest_2020",
                protocol="Harvest Finance",
                date=datetime(2020, 10, 26),
                amount_usd=34_000_000,
                network=Network.ETHEREUM,
                attack_vector=AttackVector.FLASH_LOAN,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                block_number=11129473,
                tx_hash="0x35f8d2f572fceaac9288e5d462117850ef2694786992a8c3f6d02612277b0877",
                description="Flash loan arbitrage attack on vaults",
                tags=["yield", "flash_loan"],
            ),
            Exploit(
                id="akropolis_2020",
                protocol="Akropolis",
                date=datetime(2020, 11, 12),
                amount_usd=2_000_000,
                network=Network.ETHEREUM,
                attack_vector=AttackVector.REENTRANCY,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                block_number=11229844,
                description="Reentrancy attack on savings pools",
                tags=["defi", "reentrancy"],
            ),
            Exploit(
                id="pickle_2020",
                protocol="Pickle Finance",
                date=datetime(2020, 11, 21),
                amount_usd=20_000_000,
                network=Network.ETHEREUM,
                attack_vector=AttackVector.LOGIC_ERROR,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                block_number=11292483,
                description="Evil jar swap attack exploiting controller logic",
                tags=["yield", "logic_error"],
            ),
            Exploit(
                id="value_defi_2020",
                protocol="Value DeFi",
                date=datetime(2020, 11, 14),
                amount_usd=7_000_000,
                network=Network.ETHEREUM,
                attack_vector=AttackVector.FLASH_LOAN,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                block_number=11246695,
                description="Flash loan oracle manipulation",
                tags=["defi", "flash_loan", "oracle"],
            ),
            Exploit(
                id="cheese_bank_2020",
                protocol="Cheese Bank",
                date=datetime(2020, 11, 6),
                amount_usd=3_300_000,
                network=Network.ETHEREUM,
                attack_vector=AttackVector.FLASH_LOAN,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                block_number=11186841,
                description="Flash loan price manipulation",
                tags=["lending", "flash_loan"],
            ),
            # Additional L2 exploits
            Exploit(
                id="level_finance_2023",
                protocol="Level Finance",
                date=datetime(2023, 5, 1),
                amount_usd=1_100_000,
                network=Network.BSC,
                attack_vector=AttackVector.LOGIC_ERROR,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                description="Referral claim logic bug",
                tags=["perp", "bsc", "logic_error"],
            ),
            Exploit(
                id="sentiment_2023",
                protocol="Sentiment",
                date=datetime(2023, 4, 4),
                amount_usd=1_000_000,
                network=Network.ARBITRUM,
                attack_vector=AttackVector.REENTRANCY,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                description="Reentrancy on Arbitrum lending protocol",
                tags=["lending", "arbitrum", "reentrancy"],
            ),
            Exploit(
                id="jimbo_2023",
                protocol="Jimbo Protocol",
                date=datetime(2023, 5, 28),
                amount_usd=7_500_000,
                network=Network.ARBITRUM,
                attack_vector=AttackVector.FLASH_LOAN,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                description="Flash loan attack on Arbitrum",
                tags=["defi", "arbitrum", "flash_loan"],
            ),
            Exploit(
                id="jimbos_2023",
                protocol="Jimbos Protocol",
                date=datetime(2023, 5, 28),
                amount_usd=7_500_000,
                network=Network.ARBITRUM,
                attack_vector=AttackVector.LOGIC_ERROR,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                description="Lack of slippage control",
                tags=["defi", "arbitrum", "slippage"],
            ),
            # Additional oracle manipulation exploits
            Exploit(
                id="cream_oracle_2021",
                protocol="Cream Finance (Oracle)",
                date=datetime(2021, 8, 30),
                amount_usd=18_800_000,
                network=Network.ETHEREUM,
                attack_vector=AttackVector.ORACLE_MANIPULATION,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                block_number=13127272,
                description="Oracle manipulation via flash loan",
                tags=["lending", "oracle", "flash_loan"],
            ),
            Exploit(
                id="warp_finance_2020",
                protocol="Warp Finance",
                date=datetime(2020, 12, 17),
                amount_usd=7_700_000,
                network=Network.ETHEREUM,
                attack_vector=AttackVector.ORACLE_MANIPULATION,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                block_number=11476028,
                description="Flash loan oracle manipulation",
                tags=["lending", "oracle", "flash_loan"],
            ),
            # Additional exploits to reach 70+
            Exploit(
                id="bzx_2020",
                protocol="bZx",
                date=datetime(2020, 2, 15),
                amount_usd=8_000_000,
                network=Network.ETHEREUM,
                attack_vector=AttackVector.FLASH_LOAN,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                block_number=9484688,
                description="First major flash loan attack",
                tags=["lending", "flash_loan", "historic"],
            ),
            Exploit(
                id="lendf_me_2020",
                protocol="Lendf.me",
                date=datetime(2020, 4, 19),
                amount_usd=25_000_000,
                network=Network.ETHEREUM,
                attack_vector=AttackVector.REENTRANCY,
                detectability=Detectability.HIGH,
                training_priority=TrainingPriority.P0_CRITICAL,
                block_number=9899681,
                description="ERC777 reentrancy attack",
                tags=["lending", "reentrancy", "erc777"],
            ),
        ]

        for exploit in exploits:
            self._exploits[exploit.id] = exploit

    def get(self, exploit_id: str) -> Exploit | None:
        return self._exploits.get(exploit_id)

    def get_all(self) -> list[Exploit]:
        return list(self._exploits.values())

    def get_by_network(self, network: Network) -> list[Exploit]:
        return [e for e in self._exploits.values() if e.network == network]

    def get_by_attack_vector(self, vector: AttackVector) -> list[Exploit]:
        return [e for e in self._exploits.values() if e.attack_vector == vector]

    def get_by_detectability(self, detectability: Detectability) -> list[Exploit]:
        return [e for e in self._exploits.values() if e.detectability == detectability]

    def get_by_priority(self, priority: TrainingPriority) -> list[Exploit]:
        return [e for e in self._exploits.values() if e.training_priority == priority]

    def get_trainable(self) -> list[Exploit]:
        return [e for e in self._exploits.values() if e.is_trainable]

    def get_by_year(self, year: int) -> list[Exploit]:
        return [e for e in self._exploits.values() if e.date.year == year]

    def get_with_tx_hash(self) -> list[Exploit]:
        return [e for e in self._exploits.values() if e.tx_hash is not None]

    def get_with_block_number(self) -> list[Exploit]:
        return [e for e in self._exploits.values() if e.block_number is not None]

    def get_by_tag(self, tag: str) -> list[Exploit]:
        return [e for e in self._exploits.values() if tag in e.tags]

    def get_by_min_amount(self, min_amount_usd: int) -> list[Exploit]:
        return [e for e in self._exploits.values() if e.amount_usd >= min_amount_usd]

    def total_losses(self) -> int:
        return sum(e.amount_usd for e in self._exploits.values())

    def count(self) -> int:
        return len(self._exploits)

    def summary_by_attack_vector(self) -> dict[AttackVector, dict[str, int | float]]:
        result: dict[AttackVector, dict[str, int | float]] = {}
        for vector in AttackVector:
            exploits = self.get_by_attack_vector(vector)
            if exploits:
                result[vector] = {
                    "count": len(exploits),
                    "total_usd": sum(e.amount_usd for e in exploits),
                    "avg_usd": sum(e.amount_usd for e in exploits) / len(exploits),
                }
        return result

    def summary_by_year(self) -> dict[int, dict[str, int | float]]:
        result: dict[int, dict[str, int | float]] = {}
        years = set(e.date.year for e in self._exploits.values())
        for year in sorted(years):
            exploits = self.get_by_year(year)
            result[year] = {
                "count": len(exploits),
                "total_usd": sum(e.amount_usd for e in exploits),
                "high_detectability": len([e for e in exploits if e.detectability == Detectability.HIGH]),
            }
        return result
